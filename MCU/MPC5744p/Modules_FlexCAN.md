# MPC5744
ref: Start_here.html [https://gitee.com/Wind_to_valley/mpc5744p](https://gitee.com/Wind_to_valley/mpc5744p)
# CAN-Pal模块
CAN-Pal驱动允许通过CAN总线通讯, 被设计为可在所有支持CAN的平台与IP上移植.
功能
- 可配置收发信息缓冲长度
- 标准帧&扩展帧
- 灵活传输速率
- FD格式帧内比特率切换
- 0->64字节长
- 可编程比特率
- 灵活配置邮箱以存储0->8,16,32,64比特数据长度(基于平台支持)
- 每个缓冲可配置为FlexCAN实例接收/发送, 对于MCAN, 首个MBs为Rx MBs, 0->(Rx-1)Mbs No, Tx MBs为从Rx MBs->(Rx+Tx-1)Mbs No, 均支持标准&扩展信息
- FlexCAN上, 每个缓冲区有单独Rx屏蔽, MCAN上, Rx屏蔽只适于特定过滤器(非为特定Rx消息缓冲区配置, 是一种典型过滤器类型)
- 回环模式
- MCAN不支持远程请求框架

重要!
- 使用CAN-Pal前必须先配置时钟, 参考`Clock Manager`组件
- 驱动程序为相应CAN模块启动中断，任何中断优先级都由应用程序完成
- 电路板配置在调用驱动器前完成, 驱动器对Rx/Tx功能无影响, 需由应用配置
- 使用`CAN_ReceiveBlocking()`和`CAN_SendBlocking()`带参数`timeout=0`, 消息在邮箱就绪, 将报告超时和成功收/发
- CAN终止发送会使用MBs操作而非abort, 否则可能在传输丢失帧情况下导致不可预测的行为.
- 若Flexcan接口选择了配置工具中的比特率到时间段选项，如果不能计算出所需的比特率和采样点，将返回一个默认值，其值为：Prop Seg为7，Phase Seg 1为4，Phase Seg 2为1，Prescaler Division为4。 这些值对应于比特率为500Kbits，采样点为87.5的40Mhz时钟计算。
- 若Mcan接口选择了配置工具中的比特率到时间段选项，如果不能计算出所需的比特率和采样点，将返回一个默认值，其中Prop Seg为59，Phase Seg 1为9，Phase Seg 2为9，Prescaler Division为0。 这些值对应于比特率为500Kbits，采样点为87.5的40Mhz时钟下计算。

# FlexCAN模块
FlexCAN模块是基于ISO11989-1标准和CAN2.0协议规格的通信控制器，是CAN协议规范的完全实现。带有Flexible Data rate(CAN FD)协议和CAN2.0B协议的CAN模块支持标准数据帧与扩展数据帧和64字节有效数据位，最快达8Mbps。消息缓冲区存储在FlexCAN模块专用的嵌入式RAM中。
功能
- CAN FD规范和CAN规范
  - 标准帧
  - 扩展帧
  - 0->64字节数据长度
  - 可编程比特率
  - 内容相关寻址
- ISO11898-1标准
- 灵活配置邮箱以存储0->8,16,32,64比特数据长度
- 每个邮箱可配置为收或发, 支持标准与扩展数据帧
- 每个邮箱带单独的Rx屏蔽寄存器
- 带有6帧容量和自动DMA指针的全功能RxFIFO
- 发送终止能力
- 灵活配置信息缓冲MBs为接收/发送
- 可编程时钟源 (外设时钟/振荡器时钟)
- RAM不被接收/发送结构体使用时可作为通用目的RAM空间
- 静默模式
- 可编程回环模式,支持自检操作
- 可屏蔽中断
- 高优先级仲裁方案, 延迟时间短
- 低功耗模式/与收到的帧匹配
- 快速传输CAN_FD报文时,有收发器延迟补偿功能
- 自动/软件处理远程请求框架
- 位时间设置&配置位仅在冻结模式写入
- 状态1寄存器的错误位可用于通知模块与can总线同步
- 发数据CRC校验状态
- RxFIFO全局屏蔽寄存器
- 匹配过程中可选邮箱与RxFIFO之间的优先级
- 强大的RxFIFO_ID过滤器,可将传入ID与128个扩展, 256个标准 / 512个部分(8位)ID匹配, 32个单独屏蔽能力
- Flex过往版本兼容
- 支持低功率假联网功能: 停止模式
- 检测&纠正存储器读取访问的错误, 1位错误可被纠正, 2位错误可被检测不纠正
- 禁用检测&纠正内存错误功能, 可能导致can接口冻结模式