x = [498.08538818,394.06655884,2026.48815918,1572.18981934,1938.51367188,1658.77429199,1965.56286621,1998.47790527];
y = [386.25393677,1070.81628418,2035.34631348,646.83044434,729.6239624,321.2371521,700.05883789,742.72058105];
x1=[x;y;ones(1,8)];
x = [1831.8125,1948.87561035,331.76712036,738.16473389,383.08575439,642.48028564,355.89596558,323.6842041];
y = [2587.94726562,1901.64880371,856.97387695,2275.96191406,2176.43945312,2603.58984375,2206.77856445,2161.04150391];
x2=[x;y;ones(1,8)];
%以上为输入数据x1,x2,格式为象素点[x,y,1]T,(3×n),n为点对个数>=8;
%先对x1,x2规范化处理
n=8;
u=sum(x1(1,:))/n;
v=sum(x1(2,:))/n;
s= sqrt(2)*n/sum(sqrt((x1(1,:)-u).*(x1(1,:)-u)+(x1(2,:)-v).*(x1(2,:)-v)));
T=[s,0,-s*u;0,s,-s*v;0,0,1];
x3=T*x1;
u=sum(x2(1,:))/n;
v=sum(x2(2,:))/n;
s= sqrt(2)*n/sum(sqrt((x2(1,:)-u).*(x2(1,:)-u)+(x2(2,:)-v).*(x2(2,:)-v)));
T2=[s,0,-s*u;0,s,-s*v;0,0,1];
x4=T2*x2;
Q1 = x3';
Q2 = x4';
Q = [Q1(:,1).*Q2(:,1) , ...
     Q1(:,2).*Q2(:,1) , ...
     Q1(:,3).*Q2(:,1) , ...
     Q1(:,1).*Q2(:,2) , ...
     Q1(:,2).*Q2(:,2) , ...
     Q1(:,3).*Q2(:,2) , ...
     Q1(:,1).*Q2(:,3) , ...
     Q1(:,2).*Q2(:,3) , ...
     Q1(:,3).*Q2(:,3) ] ;
[U,S,V] = svd(Q,0);
F1 = V(:,9);
F1=reshape(F1(:,1),3,3);
F1=F1';
%求得F为基础矩阵
F = T2'*F1*T ;
%输入相机内参K的值计算本质矩阵E。
a1=[2607.80785;0; 0];
a2=[0;2738.36081;0];
a3=[1298.75843;860.79498;1];
K=[a1 a2 a3];
E=K'*F*K;
%对本质矩阵进行奇异值分解。
[U,D,V] = svd(E,0);
r=D(1,1);
s=D(2,2);
t=D(3,3);
D1=[[(r+s)/2,0,0;0,(r+s)/2,0;0,0,0]];
E1=U*D1*V';
[U2,D2,V2]=svd(E1,0);
A=[0,1,0;-1,0,0;0,0,1];
R=U2*A*V2';
t=U2*[0,0,1]';

[E1,E2]=eig(R);
e3=E2(1,1);
if e3>0
    R=R;
else
    R=-R;
end



